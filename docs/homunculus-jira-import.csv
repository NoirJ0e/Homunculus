Issue ID,Issue Type,Summary,Description,Priority,Labels,Components,Epic Name,Epic Link,Story Points,Original Estimate,Depends On,Acceptance Criteria,Technical Notes
HM-EPIC-PH1,Epic,"Phase 1 - MVP Core Loop","Goal: mention-triggered NPC response with memory read/write and Anthropic integration. Exit: one NPC can run 3-4 hours without crash, p90 reply under 5 seconds (excluding provider spikes), memory retrieval and append verified.",High,"homunculus roadmap phase1 mvp",Platform,HM-PH1-MVP,,,,,,
HM-EPIC-PH2,Epic,"Phase 2 - Hardening and Operability","Goal: reliability, observability, deployment automation, and performance guardrails. Exit: multi-NPC stable run, fallback behavior verified, CI and deploy scripts ready.",Medium,"homunculus roadmap phase2 hardening",Platform,HM-PH2-HARDEN,,,,,,
HM-EPIC-PH3,Epic,"Phase 3 - Extensions","Goal: post-MVP capability expansion. Exit: dice integration, web admin panel, multi-provider support, richer NPC state model.",Medium,"homunculus roadmap phase3 extensions",Platform,HM-PH3-EXTEND,,,,,,
HM-BE-01,Task,"[BE-01] Project skeleton","Create src layout, typed settings loader, and base runtime wiring.",High,"homunculus phase1 mvp backend",Backend,,HM-PH1-MVP,1,4h,,"Repository builds; runtime entrypoint and settings loader available.","Keep layout minimal and extensible; avoid premature abstraction."
HM-BE-02,Task,"[BE-02] CharacterCard schema and validation","Implement CharacterCard schema, validation flow, and typed error model.",High,"homunculus phase1 mvp backend",Backend,,HM-PH1-MVP,2,8h,HM-BE-01,"Valid and invalid cards are handled with deterministic error messages.","Use strict schema validation and preserve clear field-level errors."
HM-BE-03,Task,"[BE-03] Discord mention listener","Implement channel-scoped listener and bot mention trigger filter.",High,"homunculus phase1 mvp backend discord",Backend,,HM-PH1-MVP,2,8h,HM-BE-01,"Bot responds only when mentioned in configured channel.","Respect Discord rate limits and reconnect semantics."
HM-BE-04,Task,"[BE-04] Recent message collector","Collect recent N messages from channel history with default 25 and configurable N.",Medium,"homunculus phase1 mvp backend discord",Backend,,HM-PH1-MVP,1,4h,HM-BE-03,"Collector returns ordered context window with role attribution.","Enforce message cap and deterministic ordering."
HM-BE-05,Task,"[BE-05] QMD adapter with fallback","Implement qmd query timeout handling and fallback to qmd search with normalized output schema.",High,"homunculus phase1 mvp backend memory qmd",Backend,,HM-PH1-MVP,3,12h,HM-BE-01,"Query executes with NPC-specific XDG paths; timeout/failure triggers fallback; normalized records returned.","Use asyncio.create_subprocess_exec; guard query size; structured logs without secrets."
HM-BE-06,Task,"[BE-06] Prompt builder and token budget","Compose system plus history plus memory prompt with truncation and budget enforcement.",High,"homunculus phase1 mvp backend llm",Backend,,HM-PH1-MVP,2,8h,"HM-BE-02|HM-BE-04|HM-BE-05","Prompt stays inside budget and preserves instruction priority.","Centralize token budgeting policy to avoid duplication."
HM-BE-07,Task,"[BE-07] Anthropic client adapter","Implement Anthropic completion adapter with model config injection.",Medium,"homunculus phase1 mvp backend llm",Backend,,HM-PH1-MVP,1,4h,HM-BE-01,"Completion requests succeed with model/provider settings from config.","Keep provider interface abstract for later expansion."
HM-BE-08,Task,"[BE-08] End-to-end response pipeline","Wire mention to retrieve to generate to send orchestration flow.",High,"homunculus phase1 mvp backend integration",Backend,,HM-PH1-MVP,3,12h,"HM-BE-03|HM-BE-06|HM-BE-07","Mention event produces one channel reply and records telemetry.","Avoid blocking the event loop on non-critical work."
HM-BE-09,Task,"[BE-09] Async memory extraction","Implement fire-and-forget memory extraction and append to daily markdown file.",High,"homunculus phase1 mvp backend memory",Backend,,HM-PH1-MVP,2,8h,HM-BE-08,"Primary reply is never blocked by extraction failure; memory append occurs asynchronously.","Failures are logged with context; no crash propagation."
HM-BE-10,Task,"[BE-10] Scheduled qmd update/embed","Implement periodic qmd update plus embed task with configurable interval.",Medium,"homunculus phase1 mvp backend memory qmd",Backend,,HM-PH1-MVP,2,8h,HM-BE-05,"Scheduler executes update cycle and handles transient command errors gracefully.","Make interval configurable and observable."
HM-BE-11,Task,"[BE-11] Hot-swap NPC identity","Archive old memory, bind new CharacterCard, and refresh Discord identity hooks.",High,"homunculus phase1 mvp backend ops",Backend,,HM-PH1-MVP,3,12h,"HM-BE-02|HM-BE-09","Old NPC memory is archived and new NPC starts with clean memory root.","Ensure no cross-character memory leakage."
HM-FE-01,Task,"[FE-01] Reply formatting templates","Create in-character reply format and minimal out-of-character notice conventions.",Low,"homunculus phase1 mvp frontend discord",Frontend,,HM-PH1-MVP,1,4h,HM-BE-08,"Reply format is consistent and readable in Discord.","Keep format lightweight to avoid token and UX noise."
HM-FE-02,Task,"[FE-02] Slash command UX","Implement /npc status, /npc reload, and /npc swap command entry points.",Medium,"homunculus phase1 mvp frontend discord",Frontend,,HM-PH1-MVP,3,12h,HM-BE-11,"Commands are registered and execute against backend services.","Command scope and permissions are explicit."
HM-FE-03,Task,"[FE-03] Command validation and errors","Return clear user-facing validation and failure messages for command flows.",Medium,"homunculus phase1 mvp frontend discord",Frontend,,HM-PH1-MVP,1,4h,HM-FE-02,"Invalid input paths return actionable messages without stack traces.","Reuse a shared error formatter for consistency."
HM-FE-04,Task,"[FE-04] Skill excerpt rendering","Load coc7e and dnd5e rule excerpts into prompt-ready text blocks.",Low,"homunculus phase1 mvp frontend prompt",Frontend,,HM-PH1-MVP,1,4h,HM-BE-06,"Selected skill rules are injected correctly based on NPC config.","Keep rules as static files with clear ownership."
HM-OPS-01,Task,"[OPS-01] Secrets contract","Create .env.example and per-NPC secret contract documentation.",Medium,"homunculus phase1 mvp devops security",DevOps,,HM-PH1-MVP,1,4h,HM-BE-01,"All required env vars are documented and validated at startup.","No secrets in repository or logs."
HM-OPS-02,Task,"[OPS-02] Agent directory bootstrap","Script creation of ~/.homunculus/agents/<npc>/ directory tree and required files.",Medium,"homunculus phase1 mvp devops",DevOps,,HM-PH1-MVP,2,8h,HM-BE-02,"Bootstrap command creates expected directories idempotently.","Use atomic file creation where possible."
HM-OPS-03,Task,"[OPS-03] Runtime packaging","Provide Docker Compose or systemd template for service runtime.",Medium,"homunculus phase1 mvp devops deploy",DevOps,,HM-PH1-MVP,3,12h,HM-BE-08,"Service can be started, stopped, and restarted with documented commands.","Document health checks and restart policy."
HM-OPS-04,Task,"[OPS-04] CI pipeline","Set up lint, unit test, and integration smoke workflow.",Medium,"homunculus phase1 mvp devops ci",DevOps,,HM-PH1-MVP,2,8h,HM-BE-01,"Pull request pipeline fails on lint/test errors and reports artifacts.","Keep CI deterministic and under acceptable runtime."
HM-OPS-05,Task,"[OPS-05] Observability baseline","Emit structured logs and token/cost metrics across runtime and adapters.",Medium,"homunculus phase1 mvp devops observability",DevOps,,HM-PH1-MVP,2,8h,HM-BE-08,"Per-request logs include latency, token usage, and error class.","Use consistent schema keys for downstream analysis."
HM-QA-01,Task,"[QA-01] CharacterCard unit tests","Cover valid and invalid CharacterCard parsing and validation paths.",Medium,"homunculus phase1 mvp testing",Testing,,HM-PH1-MVP,1,4h,HM-BE-02,"Tests cover required fields, type mismatches, and boundary values.","Use fixtures to avoid duplicated test setup."
HM-QA-02,Task,"[QA-02] QMD adapter unit tests","Cover qmd success, timeout fallback success, and dual-failure branches.",High,"homunculus phase1 mvp testing memory",Testing,,HM-PH1-MVP,2,8h,HM-BE-05,"Adapter behavior is deterministic under all command outcomes.","Mock subprocess responses and timing behavior."
HM-QA-03,Task,"[QA-03] Prompt budgeting unit tests","Verify token cap, truncation behavior, and deterministic prompt ordering.",Medium,"homunculus phase1 mvp testing llm",Testing,,HM-PH1-MVP,1,4h,HM-BE-06,"Prompt builder enforces cap without breaking required sections.","Pin test snapshots for ordering stability."
HM-QA-04,Task,"[QA-04] Mention-to-reply integration","Mock Anthropic and verify full mention trigger to channel reply flow.",High,"homunculus phase1 mvp testing integration",Testing,,HM-PH1-MVP,2,8h,HM-BE-08,"End-to-end mention handling returns one correct channel message.","Include timeout and retry edge cases."
HM-QA-05,Task,"[QA-05] Memory failure resilience test","Verify memory extraction failure does not block primary reply.",Medium,"homunculus phase1 mvp testing resilience",Testing,,HM-PH1-MVP,1,4h,HM-BE-09,"Primary response succeeds even when extraction throws errors.","Assert failure is logged once with context."
HM-QA-06,Task,"[QA-06] Hot-swap integration test","Verify old memory archive and clean-state initialization for new NPC identity.",High,"homunculus phase1 mvp testing integration",Testing,,HM-PH1-MVP,2,8h,HM-BE-11,"After swap, old data is archived and new NPC reads only new memory root.","Validate both file-system and runtime identity updates."
